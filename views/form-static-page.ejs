<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>  <%= node_id%> | My Dashboard</title>
  <% include header %>
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

  <% include nav %>
  <% include sidebar %>

  <!-- Select2 -->
  <link rel="stylesheet" href="/theme/bower_components/select2/dist/css/select2.min.css">


  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>
        Dashboard
        <small>Control panel</small>
      </h1>
      <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
        <li class="active">Dashboard</li>
      </ol>
    </section>


 <!-- Main content -->
    <section class="content">

     <form id = "content_type_article" action="/submit/<%= node_id%>" method="post">

      <div class="row">
        <div class="col-md-12">
          <div class="box box-info">

        <!-- /.box-header -->
        <div class="box-body">


          <div class ="content-headline">
            <h4 class="box-title">SAMPLE HEAD LINE CAN GO HERE... SAMPLE HEAD LINE CAN GO HERE... 
             <small>Live <i class="fa fa-fw fa-cloud-upload"></i></small>
            </h4>
          </div>

<% if(typeof frm_buttons != 'undefined') { %>
<%- frm_buttons%> 
<% } %>
          <!-- /.row -->
        </div>





              <!-- /.col -->
            </div>
            <!-- /.row -->

            </div>
          </div>
          <!-- /.box -->




          <% if(contentObject.saved == 's'){ %>
              <div class="alert alert-info alert-dismissible">
                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                Content Saved Successfully !!.
              </div>
          <% } %>

          <div class="box box-danger">
            <div class="box-body">
              <div class="row">
                <div class="col-xs-5">

                  <label>ARTICLE LAYOUT <span class="form-required" title="This field is required.">*</span></label>
                  <select class="form-control select2" style="width: 100%;">
                    <option selected="selected">Normal</option>
                    <option>No Rails</option>
                  </select>

                  <label>EDITORIAL NOTES</label>
                  <input type="text" class="form-control" placeholder="Enter ...">

                  <label>ARTICLE TYPE <span class="form-required" title="This field is required.">*</span></label>
                  <select class="form-control select2" style="width: 100%;">
                    <option value="post" selected="selected">Standard</option>
                    <option value="spread">Photo spread</option>
                    <option value="external_link">External Link</option>
                    <option value="photo">Photo post</option>
                    <option value="video">Video post</option>
                  </select>


                </div>
                <div class="col-xs-3">

                  <div class="checkbox">
                    <label>
                      <input type="checkbox">
                      UPDATE TIMESTAMP
                    </label>
                  </div>

                  <div class="checkbox">
                    <label>
                      <input type="checkbox">
                      COPYEDITED
                    </label>
                  </div>

                  <div class="checkbox">
                    <label>
                      <input type="checkbox">
                      SEND AN ALERT
                    </label>
                  </div>

                  <div class="checkbox">
                    <label>
                      <input type="checkbox" disabled>
                      STANDOUT ARTICLE
                    </label>
                  </div>

                  <div class="checkbox">
                    <label>
                      <input type="checkbox" disabled>
                      ADS ENABLE
                    </label>
                  </div>

                  <div class="checkbox">
                    <label>
                      <input type="checkbox" disabled>
                      SEARCHABLE
                    </label>
                  </div>

                  <div class="checkbox">
                    <label>
                      <input type="checkbox" disabled>
                      NATIVE AD <%= contentObject.saved %>
                    </label>
                  </div>


                </div>
                <div class="col-xs-3">



                </div>
              </div>
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /.box -->










          <div class="box box-danger">
            <div class="box-body">

  <% topInputBoxes.forEach((formDataList) => { %>
    <%- formDataList.formData %>
  <% }) %>

              <div class="form-group">
                <label>ARTICLE HEADLINE <span class="form-required" title="This field is required.">*</span></label>
                <input type="text" class="form-control" name="headlinePrimary" value="<%= contentObject.headlinePrimary %>" placeholder="Enter ...">
                <div class="messages"></div>
              </div>

              <div class="form-group">
                <label>COVER/TEASE HEADLINE <span class="form-required" title="This field is required.">*</span></label>
                <input type="text" class="form-control" placeholder="Enter ...">
              </div>

              <div class="form-group">
                <label>SOCIAL MEDIA HEADLINE <span class="form-required" title="This field is required.">*</span></label>
                <input type="text" class="form-control" placeholder="Enter ...">
              </div>

              <div class="form-group">
                <label>SEO DESCRIPTION <span class="form-required" title="This field is required.">*</span></label>
                <textarea class="form-control" rows="3" placeholder="Enter ..."></textarea>
              </div>

              <div class="form-group">
                <label>DECK <span class="form-required" title="This field is required.">*</span></label>
                <textarea class="form-control" name="deck" rows="3" placeholder="Enter ..."><%= contentObject.deck %></textarea>
              </div>
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /.box -->






          <div class="box box-danger">
            <div class="box-header with-border">
              <!-- tools box -->
              <div class="pull-right box-tools">
                <button type="button" class="btn btn-info btn-sm" data-widget="collapse" data-toggle="tooltip"
                        title="Collapse">
                  <i class="fa fa-minus"></i></button>
                <button type="button" class="btn btn-info btn-sm" data-widget="remove" data-toggle="tooltip"
                        title="Remove">
                  <i class="fa fa-times"></i></button>
              </div>
              <!-- /. tools -->


              <h3 class="box-title">BYLINE INFO</h3>
            </div>
            <div class="box-body">
              <div class="row">

                <div class="col-xs-3">
                  <label>Byline Info</label>
                  <select class="form-control select2" style="width: 100%;">
                    <option selected="selected">George P</option>
                    <option>Sandra B</option>
                  </select>
                </div>

                <div class="col-xs-3">
                  <label>Byline Type</label>
                  <select class="form-control select2" style="width: 100%;">
                    <option selected="selected">Author</option>
                    <option>Poster</option>
                    <option>Contributor</option>
                  </select>
                </div>


                <div class="col-xs-2">

                  <label>BYLINE DISPLAY <span class="form-required" title="This field is required.">*</span></label>
                  <div class="radio">
                    <label>
                      <input type="radio" name="optionsRadios" id="optionsRadios1" value="option1" checked>
                      Standard
                    </label>
                  </div>
                  <div class="radio">
                    <label>
                      <input type="radio" name="optionsRadios" id="optionsRadios2" value="option2">
                      Expanded
                    </label>
                  </div>


                </div>
                <div class="col-xs-3">
                  <div class="checkbox">
                    <label>
                      <input type="checkbox">
                      Featured Author (Verticals). <i>Featuring an author inserts the first author byline (not contributors) before the article's headline in teases on fronts and on the article.
                    </i></label>
                  </div>
                </div>

              </div>
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /.box -->






          <div class="box box-info">
            <div class="box-body">
              <div class="row">
                <div class="col-xs-3">
                <label>SOURCE</label>
                  <select class="form-control select2" style="width: 100%;">
                    <option selected="selected">George P</option>
                    <option>Sandra B</option>
                  </select>
                </div>
                <div class="col-xs-4">
                  <label>SOURCE TYPE</label>
                  <select class="form-control select2" style="width: 100%;">
                    <option value="_none">Select a value</option>
                    <option value="author" selected="selected">Author</option>
                    <option value="contributor">Contributor</option>
                    <option value="advertiser">Advertiser</option>
                  </select>
                </div>
              </div>
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /.box -->







          <div class="box box-info">
            <div class="box-header with-border">
              <h3 class="box-title">Social Art</h3>
            </div>
            <div class="box-body">
              <div class="row">
                <div class="col-xs-4">

                  <label for="exampleInputFile">File input</label>
                  <input type="file" id="imgUploader" name="imgUploader">
                  <p class="help-block">Example block-level help text here.</p>


                  <button type="button" class="btn btn-block btn-default" id ="insert_media">Insert Media</button>


                </div>
                <div class="col-xs-5">
                  <img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/123941/placeimg01.jpg" class="img-box" alt="User Image">
                </div>
                <div class="col-xs-2">

                </div>
              </div>
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /.box -->

          <div class="box">
            <div class="box-header">
              <h3 class="box-title">Content
                <small>Body</small></h3>

              <div class ="auto-tag-container"></div>

              <!-- tools box -->
              <div class="pull-right box-tools">
                <button type="button" class="btn btn-default btn-sm" data-widget="collapse" data-toggle="tooltip"
                        title="Collapse">
                  <i class="fa fa-minus"></i></button>
                <button type="button" class="btn btn-default btn-sm" data-widget="remove" data-toggle="tooltip"
                        title="Remove">
                  <i class="fa fa-times"></i></button>
              </div>
              <!-- /. tools -->
            </div>
            <!-- /.box-header -->
            <div class="box-body pad">

                <textarea name = "article_body" id="mytextarea" col="40"><%= contentObject.body %></textarea>
                <input type="text" class="form-control headline" id="live_window_id" name="live_window_id" value="111">

            </div>
          </div>


          <div class="box">
            <div class="box-header">
              <i class="fa fa-laptop"></i><strong>Remote URL:</strong> <span id ="remote_url" > - </span>
            </div>
          </div>

        </div>
        <!-- /.col-->
      </div>
      <!-- ./row -->

</form>

    </section>
    <!-- /.content -->


  </div>
  <!-- /.content-wrapper -->





<% include footer %>
<% include control-sidebar %>



  <!-- Add the sidebar's background. This div must be placed
       immediately after the control sidebar -->
  <div class="control-sidebar-bg"></div>
</div>
<!-- ./wrapper -->

<% include footer-scripts %>
<% include form-header %>

<script src="/public/rcms_plugins/widgets/widgets.js"></script>


<!--<script src="/public/components/socket.io-1.2.0.js"></script>
    <script>
      $(function () {
          var socket = io();
      $('#test_headline').keydown(function( event ) {
        console.log(event.which);

        socket.emit('chat message', $('#test_headline').val());
          //$('#test_headline').val('');
          //return false;
      });

        socket.on('chat message', function(msg){
          //$('#messages').append($('<li>').text(msg));
          //window.scrollTo(0, document.body.scrollHeight);
          //$('#socket-window').append(msg);
          //tinymce.activeEditor.selection.setCursorLocation(tinymce.activeEditor.getBody(),0)
          if ($('#live_window_id').val() == 111) {
            tinymce.get('mytextarea').insertContent(msg);
          }
        });
      });
    </script>
-->


<!-- Page script -->
<script>
  $(function () {

  // Hide Sidebar on edit.
  $('.sidebar-toggle').click();

  //var socket = io();


  //https://github.com/StevenDevooght/tinyMCE-mention
  tinymce.init({
    selector: '#mytextarea',
    height: 500,
    theme: 'modern',
    plugins: 'rcms_widget paste print mention autosave preview fullpage searchreplace autolink directionality visualblocks visualchars fullscreen image link media template codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists textcolor wordcount imagetools contextmenu colorpicker textpattern help',
    toolbar1: 'restoredraft | formatselect | bold italic strikethrough forecolor backcolor | link | alignleft aligncenter alignright alignjustify  | numlist bullist outdent indent  | image| rcms_widget',
    image_advtab: true,
    templates: [
      { title: 'Test template 1', content: 'Test 1' },
      { title: 'Test template 2', content: 'Test 2' }
    ],
    mentions: {
        source: [
            { name: 'Amazon Product IPHONE 11' },
            { name: 'Ebay Product Diamond Jewelry' },
            { name: 'Orgnanic LED TV 120 Inch' },
            { name: 'Spring Dress' }
        ]
    },
    autosave_interval: "30s",
    media_live_embeds: true,
    paste_data_images: true,
    // without images_upload_url set, Upload tab won't show up
    images_upload_url: '/upload',
    // we override default upload handler to simulate successful upload
    images_upload_handler: function (blobInfo, success, failure) {
      setTimeout(function() {
        //console.log(blobInfo);
        // no matter what you upload, we will turn it into TinyMCE logo :)
        success('http://moxiecode.cachefly.net/tinymce/v9/images/logo.png');
      }, 2000);
    },
  init_instance_callback: function (editor) {
    editor.on('Dirty', function (e) {
      //alert('Editor is dirty!');
    });
    editor.on("keyup", function(e){
     //alert(tinymce.activeEditor.getContent());
    //console.log(e.which);
    //socket.emit('chat message', String.fromCharCode(e.which));
  });

    let triggerWord = '';
    editor.on("keyup", function(e){
     if (e.keyCode == 32 && triggerWord != '') {
      //alert("The word is: " + triggerWord);
      $.ajax({
        url: 'http://localhost:4000/auto-tag/',
        type: 'post',
        timeout: 10000,
        data: { keyword: triggerWord },
        success: function(data) {
          $('.auto-tag-container').html(data);
          //alert(data);
        },
        error: function(request, status, err) {
          alert("Error: " + request + status + err);
        }
      });
      triggerWord = '';
     }
     triggerWord += String.fromCharCode(e.which).toLowerCase();
  });


    editor.on('PastePreProcess', function (e) {
      //alert("I am about to Paste" + e.content);

    if (new RegExp(/.*(amazon\.com)/, "i").test(e.content)) {
      const re = /\/([A-Z0-9]{10})(\/|\?|\b)/i
      let asinMatch = re.exec(e.content);
      let asinID = asinMatch[1];
      e.content = '';
      $.ajax({
        url: 'http://localhost:4000/helpers/product-api/',
        timeout: 10000,
        data: { asin: asinID },
        success: function(data) {
          tinymce.activeEditor.insertContent('<img src ="'+ data.image +'" height = "180" width = "200"><p>' + data.title + ' <b>(' + data.price + ') </b></p>');
        },
        error: function(request, status, err) {
          alert("Error: " + request + status + err);
        }
      });
    }

    if (new RegExp(/.*(facebook\.com)/, "i").test(e.content)) {
      e.content = '<iframe src="https://www.facebook.com/plugins/post.php?href=https%3A%2F%2Fwww.facebook.com%2Fairtableapp%2Fposts%2F1976245169287448&width=200" width="200" height="180" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true" allow="encrypted-media"></iframe>';
    }

    if (new RegExp(/.*(youtube\.com)/, "i").test(e.content)) {
      let youTubeId = '';
      const regExp = /^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
      const match = e.content.match(regExp);
      if (match && match[2].length == 11) {
        youTubeId = match[2];
      }
      e.content = '<iframe width="200" height="180" src="https://www.youtube.com/embed/'+ youTubeId + '" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>';
    }

    });

    editor.on('PastePostProcess', function (e) {
      //alert("I am about to Paste" + e.content);
      //e.content += '<h1>HELLOW WORLD</h1>!';

    });

      //ed.execCommand('mceImage');
    },

    content_css: [
      '//fonts.googleapis.com/css?family=Lato:300,300i,400,400i',
      '//www.tinymce.com/css/codepen.min.css',
      '/theme/bower_components/bootstrap/dist/css/bootstrap.min.css'
    ]
   });

  });

  // Dynamic Validation Constrains
  var constraints =<%-JSON.stringify(validPattern)%>
  let validate_data = new validation();
  validate_data.validateForm();

  $( function() {

    //Dynamic JS Inject
    <%-formJSHeader%>

    $('.select2').select2();

    $('#insert_media').click(function() {
      modalObj('http://localhost:4000/endpoints/mediaSearch' , {type: 'GET', contextClass: 'rock-cms-image-grid', modalContainer: '#media_modal', callBack: testClick});
    });


const testClick = (targetObj) => {
    $(targetObj).find('a').click(function (e) {
      console.log(this);
      console.log( $(this).find('figure img').attr('src') );
      tinymce.activeEditor.selection.setNode(tinymce.activeEditor.dom.create('img', {src: $(this).find('figure img').attr('src'), title: 'HELLOOO'}));
      $('.modal-close-button').click();
    });
}

    $('#media_modal .modal-settings, #media_modal .modal-insert-button').click(function() {
      alert("TEST");
    });


  });

  </script>
</body>
 <%-hidden_dom_containers%>
</html>
